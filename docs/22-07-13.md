# Meeting Notes: 22-07-13

## Old Business

### localhost issue

Divyansh stated the localhost issue occurs on a shared server because the domain name `https://amp.dev` is used in the repo. The problem does not exist when using a local machine that correctly resolves localhost.

Solution: replace the Google domain name with target domain names.

### Irregularities with version-2

Divyansh will combine the best of version-1 and version-2 and create version-3.

## New Business

### Define Docker resources and Docker-resource-dependencies

Anant asked for a clear definition of internal and external resources.
  * Internal means: resources used to create a Docker instance.
  * External means: resources used by a production Docker instance.

#### External Resource

##### AMP libraries

Example *before* amp-optimization:
```
<script async src="https://cdn.ampproject.org/v0.js"></script>
<script async custom-element="amp-story" src="https://cdn.ampproject.org/v0/amp-story-1.0.js"></script>
```

Example *after* amp-optimization:
```
<script async src="https://cdn.ampproject.org/v0.mjs" type="module" crossorigin="anonymous"></script>
<script async nomodule src="https://cdn.ampproject.org/v0.js" crossorigin="anonymous"></script>

<script async src="https://cdn.ampproject.org/v0/amp-story-1.0.mjs" custom-element="amp-story" type="module" crossorigin="anonymous"></script>
<script async nomodule src="https://cdn.ampproject.org/v0/amp-story-1.0.js" crossorigin="anonymous" custom-element="amp-story"></script>
```

##### Fonts

Example:
```
<link rel="preload" as="font" type="font/ttf"   href="https://s3.amazonaws.com/benetta.net/fonts/recursive-woff2/Recursive-VF.ttf" crossorigin />

@font-face {
    font-family: Recursive-2019;
    src:url("https://s3.amazonaws.com/benetta.net/fonts/recursive-woff2/Recursive-VF.ttf") format("truetype");
    font-display: swap;
    text-align: initial;
    font-weight: 100 600;
    font-stretch: 25% 151%;
}
```

#### iFrame Content

Content featured in an iFrame is served from `https:\\benetta.io`

Example:
```
<amp-iframe
  data-iframe-label="0.6-21 Example: SMV Baseline"
  height="450px"
  layout="fixed-height"
  scrolling="yes"
  sandbox="allow-scripts allow-same-origin allow-popups allow-forms allow-popups-to-escape-sandbox allow-presentation allow-top-navigation"
  allow="fullscreen"
  frameborder="0"
  src="https://benetta.io/iframe/SDL-SML-down/item-16.html"
  title="Schema Markup Validator reading SDL example eg-0399-jsonld (local)"
  class="ap-o-sampler-iframe"
>
<div placeholder=""><div class="ap-o-sampler-iframe-source"></div></div>
</amp-iframe>
```

#### JSON endpoints

Text for Natural Language (NL) pages is rendered in Unicode and stored as JSON.
JSON endpoints are exposed to a page as a JSON list element and rendered using a Mustache template.

Example:
```
<amp-list
  width="auto"
  height="1"
  layout="fixed-height"
  template="must-1"
  binding="refresh"
  src="https://ontomatica.io/a/12010500001014723136/data-11.json"
><div placeholder>Loading ...</div><div fallback>Failed to load data.</div><div overflow class="list-overflow">See more</div>
</amp-list>
```
For the link:
  * https://ontomatica.io/a/12010500001014723136/

In the case above, JSON is served from ontomatica.io. In the future, JSON endpoints will be served from AWS-S3, e.g.
  * https://s3.amazonaws.com/benetta.net/data/

##### Structured Data and query services

All content pages will include Structured Data. Remote processors will read and present information about local structured data. A link in the accordion footer of each page will include the link to run the remote processor. A separate web page presented the processor output.

Example processor:
  * https://validator.schema.org/

#### JavaScript Applications

We serve JavaScript applications.
Here is an example from `afdsi.com`
  * https://afdsi.com/sparql-species/#/specierch/octopus

In the future, we will serve this type of JavaScript application from AWS-S3. For example:
  * https://s3.amazonaws.com/benetta.net/app/species/index.html#/specierch/octopus

### Describe `amp-search` operation

We spent meeting-time tracing the `amp-search` workflow. Jay agreed to document the workflow, as follows.

  1. `amp-autosuggest` loads a JSON file to present level-1 options. The query is:
    * https://amp.dev/search/autosuggest?__amp_source_origin=https%3A%2F%2Famp.dev

The response is:
```
{"items":["amp-3d-gltf","amp-3q-player","amp-access","amp-access-fewcents","amp-access-laterpay","amp-access-poool","amp-access-scroll","amp-accordion","amp-action-macro","amp-ad","amp-ad-custom","amp-ad-exit","amp-ad-network-adsense-impl","amp-ad-network-adzerk-impl","amp-ad-network-dianomi-impl","amp-ad-network-doubleclick-impl","amp-ad-network-fake-impl","amp-ad-network-nws-impl","amp-ad-network-smartadserver-impl","amp-ad-network-valueimpression-impl","amp-addthis","amp-analytics","amp-anim","amp-animation","amp-animation-polyfill","amp-apester-media","amp-audio","amp-auto-ads","amp-auto-lightbox","amp-autocomplete","amp-base-carousel","amp-beopinion","amp-bind","amp-bodymovin-animation","amp-brid-player","amp-brightcove","amp-byside-content","amp-cache-url","amp-call-tracking","amp-carousel","amp-connatix-player","amp-consent","amp-crypto-polyfill","amp-dailymotion","amp-date-countdown","amp-date-display","amp-date-picker","amp-delight-player","amp-dynamic-css-classes","amp-embedly-card","amp-experiment","amp-facebook","amp-facebook-comments","amp-facebook-like","amp-facebook-page","amp-fit-text","amp-font","amp-form","amp-fx-collection","amp-fx-flying-carpet","amp-geo","amp-gfycat","amp-google-document-embed","amp-gwd-animation","amp-hulu","amp-iframe","amp-iframely","amp-ima-video","amp-image-lightbox","amp-image-slider","amp-image-viewer","amp-img","amp-imgur","amp-inline-gallery","amp-inputmask","amp-instagram","amp-install-serviceworker","amp-intersection-observer-polyfill","amp-izlesene","amp-jwplayer","amp-kaltura-player","amp-layout","amp-lightbox","amp-lightbox-gallery","amp-link-rewriter","amp-list-load-more","amp-live-list","amp-loader","amp-mathml","amp-mega-menu","amp-megaphone","amp-minute-media-player","amp-mowplayer","amp-mraid","amp-mustache","amp-nested-menu","amp-next-page","amp-nexxtv-player","amp-o2-player","amp-onetap-google","amp-ooyala-player","amp-orientation-observer","amp-pan-zoom","amp-pinterest","amp-pixel","amp-playbuzz","amp-position-observer","amp-powr-player","amp-reach-player","amp-recaptcha-input","amp-redbull-player","amp-reddit","amp-render","amp-resize-observer-polyfill","amp-riddle-quiz","amp-script","amp-selector","amp-shadow-dom-polyfill","amp-sidebar","amp-skimlinks","amp-slides","amp-smartlinks","amp-social-share","amp-soundcloud","amp-springboard-player","amp-standalone","amp-state","amp-sticky-ad","amp-story","amp-story-360","amp-story-animation","amp-story-auto-ads","amp-story-auto-analytics","amp-story-bookend","amp-story-bookend","amp-story-captions","amp-story-consent","amp-story-cta-layer","amp-story-dev-tools","amp-story-education","amp-story-grid-layer","amp-story-grid-layer","amp-story-interactive","amp-story-interactive-binary-poll","amp-story-interactive-img-poll","amp-story-interactive-img-quiz","amp-story-interactive-poll","amp-story-interactive-quiz","amp-story-interactive-results","amp-story-page","amp-story-page","amp-story-page-outlink","amp-story-panning-media","amp-story-player","amp-story-share-menu","amp-story-shopping","amp-story-shopping-attachment","amp-story-shopping-config","amp-story-shopping-tag","amp-story-social-share","amp-stream-gallery","amp-subscriptions","amp-subscriptions-google","amp-tiktok","amp-timeago","amp-truncate-text","amp-twitter","amp-user-notification","amp-video","amp-video-docking","amp-video-iframe","amp-viewer-integration","amp-vimeo","amp-vine","amp-viqeo-player","amp-vk","amp-web-push","amp-wistia-player","amp-wordpress-embed","amp-yotpo","amp-youtube"]}
```
  2. For an item in autosuggest, user selects an option. For example type the word:
    * lightbox
  3. `amp-autosuggest` response:
    * amp-image-lightbox
    * amp-lightbox
    * amp-lightbox-gallery
  4. From autosuggest response, select
    * amp-lightbox
  5. `amp.dev` fires the query:
    * https://amp.dev/search/do?q=amp-lightbox&locale=en&__amp_source_origin=https%3A%2F%2Famp.dev
  6. Response:
```
{"result":{"totalResults":298,"currentPage":1,"pageCount":30,"components":[{"title":"amp-lightbox","description":"Displays elements in a full-viewport “lightbox” modal.","url":"https://amp.dev/documentation/components/amp-lightbox/","exampleUrl":"https://amp.dev/documentation/examples/components/amp-lightbox/?format=websites","playgroundUrl":"https://playground.amp.dev/?url=https%3A%2F%2Fpreview.amp.dev%2Fdocumentation%2Fexamples%2Fcomponents%2Famp-lightbox"},{"title":"amp-lightbox-gallery","description":"Provides a \"lightbox” experience. Upon user interaction, a UI component expands to fill the viewport until it is closed by the user.","url":"https://amp.dev/documentation/components/amp-lightbox-gallery-v1.0/"},{"title":"amp-image-lightbox","description":"Provides a lightbox effect for a specified image.","url":"https://amp.dev/documentation/components/amp-image-lightbox/","exampleUrl":"https://amp.dev/documentation/examples/components/amp-image-lightbox/?format=websites","playgroundUrl":"https://playground.amp.dev/?url=https%3A%2F%2Fpreview.amp.dev%2Fdocumentation%2Fexamples%2Fcomponents%2Famp-image-lightbox"}],"pages":[{"title":"Example: amp-lightbox","description":"The amp-lightbox component allows for a \"lightbox\" or similar experience - where upon user interaction a component expands to fill the viewport, ...","url":"https://amp.dev/documentation/examples/components/amp-lightbox.email/"},{"title":"Example: amp-image-lightbox","description":"The amp-image-lightbox component allows the user to expand an image to fill the viewport. Setup. Import the amp-image-lightbox component in the header. <script ...","url":"https://amp.dev/documentation/examples/components/amp-image-lightbox/"},{"title":"Example: amp-lightbox-gallery","description":"The amp-lightbox-gallery component provides a \"lightbox” experience for AMP components (e.g., amp-img, amp-carousel).","url":"https://amp.dev/documentation/examples/components/amp-lightbox-gallery/"},{"title":"Actions and events","description":"Fired when the carousel's current slide changes. // Slide number. event.index. amp-lightbox. Event, Description, Data. lightboxOpen ...","url":"https://amp.dev/documentation/guides-and-tutorials/learn/amp-actions-and-events/"},{"title":"Example: Image Galleries with amp-carousel","description":"The amp-lightbox-gallery component allows us to quickly create a lightbox gallery. <script async custom-element=\"amp-lightbox-...","url":"https://amp.dev/documentation/examples/multimedia-animations/image_galleries_with_amp-carousel/"},{"title":"Documentation: amp-carousel","description":"amp-carousel amp-lightbox-gallery AMP for E-Commerce Getting Started Product ... <amp-carousel width=\"450\" height=\"300\" layout=\"responsive\" type=\"slides\"...","url":"https://amp.dev/documentation/components/amp-carousel/"},{"title":"App like animation experiences in AMP – The AMP Blog","description":"Mar 28, 2019 ... When dismissing an image while exiting lightbox mode, the transition back to the inline image is sudden as you can see below: Inspired by...","url":"https://blog.amp.dev/2019/03/28/app-like-animation-experiences-in-amp/"}]},"initial":false,"nextUrl":"https://amp.dev/search/do?q=amp-lightbox&locale=en&page=2"}
```

Note the last JSON statement:
```
"nextUrl":"https://amp.dev/search/do?q=amp-lightbox&locale=en&page=2"
```
The first response ("page=1") will fill an HTML form. If the response is longer than the target HTML form, the overflow content is placed in a second JSON response.
The second response ("page=2") is loaded when a user selects a "Show more" button.

For example, for "lightbox" the following links are triggered:
  * https://amp.dev/search/do?q=amp-lightbox&locale=en&page=2&__amp_source_origin=https%3A%2F%2Famp.dev
  * https://amp.dev/search/do?q=amp-lightbox&locale=en&page=3&__amp_source_origin=https%3A%2F%2Famp.dev
  * https://amp.dev/search/do?q=amp-lightbox&locale=en&page=4&__amp_source_origin=https%3A%2F%2Famp.dev

An AMP or Ontomatica developer creates the JSON file that is processed by the `amp-search` function.

### Progress with GitHub Action based CI/CD for amp.dev

Divyansh is continuing to customize the amp.dev GitHub Action-based CI/CD workflow.

Jay indicated the planned test of the GH Action CI/CD workflow will be:
  1. Change one menu item for amp.dev.
  2. Change the page linked to the changed menu item.
  3. Use S3-hosted fonts from benetta.net.
  4. Generate simple home pages for 5 sites (excluding the ontomatica.io home page, which is complicated)

### Ontomatica support for CI/CD project
  1. Jay will work with Ankita to provide AWS access for Divyansh.
  2. Jay will work with Ankita to set up all target domains and sub-domains.

---

## Phase-1

### AS-IS
  * amp.dev is dockered
  * supporting two ports:
    - amp.dev
    - amp.playground
  * supporting local development
    - Win-10 running WSL
    - MacBook running Monterey
  * docker operating process is documented

### TO-DO
  * Configure staging domain:
    - Ankita has implemented: https://ontomatica.com
    - Need to configure ontomatica.com without port:8080 dependency
    - test: search works
  * Model - Google QA process:
    - using Google appspot
      - https://console.cloud.google.com/appengine/start?project=basic-search-180910
  * Example - Google AMP QA site:
    - https://amp-dev-staging.appspot.com/documentation/components/amp-fit-text-v1.0/?format=websites

## Phase-2

### Development
  - Support 6 ports that map to 6 domains

### Workflow
  - Implement GitHub Actions based on Google `release-schedule` template or similar Google template.
  - Generate a `docker-production-instance` for a QA domain.

## Operating Notes
  - Divyansh says:
    - `docker-production-instance-linux` will perform as well as a `bare-metal-production-instance-linux`. The reason is that docker-as-a-service is integrated with the linux environment and does not entail additional overhead.
    - In contrast, `docker-development-instance-windows` (or mac) will be slower decause docker is an application and must work through windows/mac app services (overhead).

