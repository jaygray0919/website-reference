# Meeting Procedures and Notes 22-06-20

  * Meeting notes use notation from Roberts Rules of Order
    - "Unfinished business":
      * Any item that was pending when the previous meeting adjourned
    - "New business"
      * Introduce new item for consideration
  * Reference
    - https://www.jimslaughter.com/order-of-business-for-meetings-

## Phase-1

### AS-IS

  * amp.dev is dockered
  * supporting two ports:
    - amp.dev
    - amp.playground
  * supporting local development
    - Win-10 running WSL
    - MacBook running Monterey
  * docker operating process is documented

### TO-DO

  * Configure staging domain:
    - Ankita has implemented: https://ontomatica.com
    - Need to configure ontomatica.com without port:8080 dependency
    - test: search works
  * Model - Google QA process:
    - using Google appspot
      - https://console.cloud.google.com/appengine/start?project=basic-search-180910
  * Example - Google AMP QA site:
    - https://amp-dev-staging.appspot.com/documentation/components/amp-fit-text-v1.0/?format=websites

## Phase-2

### Development

  - Support 6 ports that map to 6 domains

### Workflow

  - Implement GitHub Actions based on Google `release-schedule` template or similar Google template.
  - Generate a `docker-production-instance` for a QA domain.

## Operating Notes

  - Divyansh says:
    - `docker-production-instance-linux` will perform as well as a `bare-metal-production-instance-linux`. The reason is that docker-as-a-service is integrated with the linux environment and does not entail additional overhead.
    - In contrast, `docker-development-instance-windows` (or mac) will be slower decause docker is an application and must work through windows/mac app services (overhead).

---

## Unfinished Business

### stripe-docker implemented as ontomatica.com
  - discussed local-host issue blocking search (where 8080 is injected into URL)
  - will be resolved

## New Business

### Domains and GitHub workflow
  - Divansh recommended using the word "staging" as the term for testing an instances on an EC2 server
  - Divyansh presented and will update Jay's draft CI/CD workflow using Mermaid diagramming tool
  - Rather than using domain.com for staging, Divyansh recommended using a sub-domain
  - Jay expressed idea that staging sub-domains be aligned with GitHub-registered developer names, e.g.
      - jay.ontomatica.io
      - ankita.ontomatica.io
      - divyansh.ontomatica.io
  - any developer may have only one sub-domain active at a time
  - similarly, a planned release will have only one sub-domain active at a time

### Acceptance testing for Phase 2 GitHub workflow
  - Jay stated that acceptance of Phase 2 will have a simple test:
    - Generation of a simplified home-page for each site
    - Generation of a simplified staging-page for each site
  - Jay and Ankita are responsibile for creating the content to be generated for the six home-page instances and six staging-page instances

### TO-DO
  - Jay will work with Ankita upon her return from travel to implement appropriate access and authorization for Divyansh to configure AWS and GitHub services for Phase 2.
  
### Planned site roll-out
  - Jay stated that site roll-out had two phases:
  1. All Natural Language pages, linked to target NL menu items, will be created but display a notice (in the NL): "This page is under construction"
  2. Over time, each "under construction" page will be replaced with content
  - Reasoning behind this approach:
    - Establish the basic structure (menus and navigation) for all sites
    - Incrementally improve sites "one page at a time"
    - One-page-at-a-time approach may minimize a developer's effort by focusing only on the target page
    - Target pages will be evaluated using sub-domain approach discussed above.

---

## Divyansh notes

### CI/CD workflow
  * Divyansh proposes this workflow
    - https://mermaid.live/view#pako:eNqtVMtugzAQ_BXLEeKSVk164xZI1UtUqc2ViwEDVrGJwPShiH_vgiHg4EBV9ZDI7M7OzK5hzzjMI4odbFlnXyAmmHRQc0LIzvLkQD9oZjvIjmhQJfZaJWRKOW2iASlpH0yYfC7IKbX7eoiVaf7pFkSEKS0hLouKrsc5L-ecyQMJGpGYZOWQ5oQJVfpClBgnpaSF3QJq-IdfbVlw8EWvDQ-rfWM5P3EqJDyGrQIcgpYLRSpryMSUyKqgu0nEbSUQ9BC-55UcAy8c10l3LmmuHJxxWiT0AkaSJA7yMeTvNvcbH3d2Zgh0_94YvejVBDQMzUSifA_gX3Tn6t1tL91d0Xv_4dH7m0dP9_g48Xgt3ePfPIA_9PDVEcJMJLNXVg4Yjep1N6bqwPBFxuxrtziagVQrdG_hTbxTLjWjDqv53EwmZBBccDpVHjiU8oBd9udq_tRbtjJMeHsXM0GymRvWtPWLHtUam1P76xZHf719KV5jwMEWjGA5twvVx-3e9bF6F2NSZbIpqQFanSIi6VPEZF5gp92zmFQyP36LEHebtQPtGUkKwrto_QOtex3r

### reverse proxy issue
  * I have fixed/completed the reverse proxy setup and fixed other minor issues that were Identified.
  1. Provisioned reverse proxy setup via Caddy. I have stopped Nginx and disabled it and configured Caddy Web Server which is simple to use, configure, and maintain and pretty fast as it's written in Go. It also has other benefits like a forever-free SSL certificate and hardened TLS stack. 
  2. "docker-compose" and "docker" were not running with the unprivileged user(ec2-user) and as running with the root user is not recommended for obvious reasons, I fixed this issue and now these can be run with the ec2-user. 
  3. I have set up a Caddy web server over docker containers, so that's easy to maintain and replicate. All apps are running on docker containers now.

## Jay notes

### Configurations

  * Ankita and I discussed DNS formalization for these domains
    - ontomatica.io
    - dailyfood.io
    - dailycare.io
    - electronic-label.io
    - eximdata.io
    - afdsi.org
  * Each domain will have a page like this
    - https://ontomatica.io/
    - https://afdsi.org/
  * Each domain will support subdomain configurations like this
<pre>
        dev.ontomatica.io
      stage.ontomatica.io
     ankita.ontomatica.io
        jay.ontomatica.io
   divyansh.ontomatica.io
</pre>
  * Illustration
    - https://afdsi.com/___supplier/stripe/subdomain-config/subdomains.svg

### Business development
  * We have an opportunity to work with Google to improve/extend the amp-dev project
  * Next step is to demonstrate a docker-amp-dev instance where the search function works correctly
  * When that link is stable, I'll set meetings with Google to discuss next steps

---

## Technical Details: Benetta Consortium

## Compute platforms

### AWS EC2

#### Static apps

  * Sample website:
    - https://afdsi.com/ontomatica-home/

#### Dynamic apps served from database

  * Web page:
    - https://wedge.ontomatica.io/
  * Example transaction:
    - https://wedge.ontomatica.io/Nobel-Prize-Winners_-_19-09-05/Wedge
    - https://wedge.ontomatica.io/Nobel-Prize-Winners_-_19-09-05/Wedge?q=facet_10:2/facet_42:793&group=facet_42
  * Note:
    - Ankita uses docker to configure instances for different EC2 servers
      - two wedge instances run on a "more powerful" server
      - other instances run on a "less powerful" server

#### AWS Lambda

  * Ankita configured this logic-intensive app to run on AWS Lambda:
    - https://klpuiljexh.execute-api.us-east-1.amazonaws.com/Prod/
  * Source data (which will be hosted on AWS/S3):
    - https://afdsi.com/data/onto-corporation-sans-brand/data.json
  * Example transaction on AWS Lambda:
    - https://klpuiljexh.execute-api.us-east-1.amazonaws.com/Prod/?url=https://afdsi.com/data/onto-corporation-sans-brand/data.json
  * Example transaction on Google Schema Markup Validator using the same data:
    - https://validator.schema.org/#url=https%3A%2F%2Fafdsi.com%2Fdata%2Fonto-corporation-sans-brand%2Fdata.json

### AWS S3

#### benetta.net domain and fonts

  * Fonts are implemented as follows (example):
```
    @font-face {
      font-family: Recursive-2019;
      src: url("https://s3.amazonaws.com/benetta.net/fonts/recursive-woff2/recursive-2019_11_22-20_38.woff2") format("woff2-variations");
      text-align: initial;
      font-weight: 100 1000;
      font-stretch: 25% 151%;
      font-display: swap;
    }
```

#### benetta.net domain and JavaScript

  * Example - JavaScript libraries and applications:
    - https://s3.amazonaws.com/benetta.net/app/species/index.html#/specierch/octopus
  * For comparison, here is the same app running from an EC2 server:
    - https://afdsi.com/sparql-species/#/specierch/octopus

#### Benetta JSON endpoints

  * Example page:
    - https://ontomatica.io/a/12120000001000011961/
  * JSON endpoint:
    - subset here for easier understanding (complete file will be on AWS/S3/benetta.net)
````
<script type="application/json">
{"items": [
  {"text":
    "<div>
    <b>This Privacy Policy provides our policies and procedures for collecting, using, and disclosing your information</b>
    <ol>
    <li type='A'><a class='underline' href='#summary'>Summary</a></li>
    <li type='A'><a class='underline' href='#complete-terms'>Complete Terms</a></li>
    </ol>
    <ol>
    <li type='1'><a class='underline' href='#terms-conditions'>Terms and Conditions and Your Consent</a></li>
    <li><a class='underline' href='#what-info'>What Information We Collect</a></li>
    <li><a class='underline' href='#how-we-use'>How We Use Your Information</a></li>
    <li><a class='underline' href='#your-choices'>Your Choices</a></li>
    <li><a class='underline' href='#safeguarding'>Safeguarding Your Information</a></li>
    <li><a class='underline' href='#share-info'>How We Share Your Information</a></li>
    <li><a class='underline' href='#links-to-sites'>Links to Other Sites</a></li>
    <li><a class='underline' href='#california-privacy'>Your California Privacy Rights</a></li>
    <li><a class='underline' href='#jurisdiction'>Jurisdiction</a></li>
    </ol>
    </div>"
  }
]}
</script>
````
  * Parser that formats JSON as HTML:
````
<template type="amp-mustache">
  {{{text}}}
</template>
````

## EC2 domains

### iFrame domain

  * Some pages on production domains will use iFrame to serve specific content
  * Browsers same-site policy blocks iframe unless content is served from a different site
  * Our site to serve content to an iframe used on production site pages:
    - benetta.io

### Production domains

  * ontomatica.io
  * dailyfood.io
  * dailycare.io
  * electronic-label.io
  * eximdata.io
  * afdsi.org

### For all domain.io

  * root
    - robots.txt
    - sitemap.xml
    - manifest.json
    - google_validation_ID.html
    - favicon.ico
  * /static/
    - files
  * /a/ (a for AMP files)
    - directory is 20 digit IDN
  * /s/ (s for system files)
    - directory is a logical name
  * /c/ (c for chemical files)
    - directory may be inchikey
  * /n/ (n for nalt RDF files)
    - file system TBD

## File System for all domains and s3.amazonaws.com/benetta.net

### Files

  * In general all files are *one* of the following:
    - index.html
    - styles.css
    - main.js
    - data.json
    - note.txt
    - image-widthValue-heightValue.png
    - diagram-widthValue-heightValue.svg
  
### Directories

  * In general, a directory is a *20 digit identifier*.
  * The first 18 digits have a structure based on data types (which we can easily decode).
  * The last two digits indicate the Natural Language of index.html in a specific directory.
  * The directory structure is flat; for all index.html pages coded as AMP, the directories will be:
    - https://domain.suffix/a/
    - examples:
      - Chinese  https://ontomatica.io/a/12370110501010001933/
      - French   https://ontomatica.io/a/12370110501010001936/
      - Hindi    https://ontomatica.io/a/12370110501010001939/
      - en-US    https://ontomatica.io/a/12370110501010001961/

## HTML \<head>

  * In general, an AMP HTML \<head> will include this information:
````
<meta name="page-locale" property="schema:Text" content="ar,cs,de,en-GB,en-US,es,fr,hi,it,ja,ko,pl,pt,ru,zh">
<link title="French" rel="canonical" type="text/html" hreflang="fr" href="https://ontomatica.io/a/12370110501010001936/">
<link title="Arabic [ar]" rel="alternate" type="text/html" hreflang="ar" href="https://ontomatica.io/a/12370110501010001931/">
<link title="Czech [cs]" rel="alternate" type="text/html" hreflang="cs" href="https://ontomatica.io/a/12370110501010001934/">
<link title="German [de]" rel="alternate" type="text/html" hreflang="de" href="https://ontomatica.io/a/12370110501010001938/">
<link title="English [en-GB]" rel="alternate" type="text/html" hreflang="en-GB" href="https://ontomatica.io/a/12370110501010001960/">
<link title="English [en-US]" rel="alternate" type="text/html" hreflang="en-US" href="https://ontomatica.io/a/12370110501010001961/">
<link title="Spanish [es]" rel="alternate" type="text/html" hreflang="es" href="https://ontomatica.io/a/12370110501010001953/">
<link title="French [fr]" rel="alternate" type="text/html" hreflang="fr" href="https://ontomatica.io/a/12370110501010001936/">
<link title="Hindi [hi]" rel="alternate" type="text/html" hreflang="hi" href="https://ontomatica.io/a/12370110501010001939/">
<link title="Italian [it]" rel="alternate" type="text/html" hreflang="it" href="https://ontomatica.io/a/12370110501010001941/">
<link title="Japanese [ja]" rel="alternate" type="text/html" hreflang="ja" href="https://ontomatica.io/a/12370110501010001942/">
<link title="Korean [ko]" rel="alternate" type="text/html" hreflang="ko" href="https://ontomatica.io/a/12370110501010001944/">
<link title="Polish [pl]" rel="alternate" type="text/html" hreflang="pl" href="https://ontomatica.io/a/12370110501010001948/">
<link title="Portuguese [pt]" rel="alternate" type="text/html" hreflang="pt" href="https://ontomatica.io/a/12370110501010001949/">
<link title="Russian [ru]" rel="alternate" type="text/html" hreflang="ru" href="https://ontomatica.io/a/12370110501010001950/">
<link title="Chinese [zh]" rel="alternate" type="text/html" hreflang="zh" href="https://ontomatica.io/a/12370110501010001933/">
````

## HTML content \<body>

Content will be managed in one of three formats:
  1. markdown
    - example markdown source:
      - https://github.com/ampproject/amphtml/blob/main/docs/release-schedule.md
    - example HTML generated from markdown source:
      - https://amp.dev/documentation/guides-and-tutorials/learn/spec/release-schedule/
  2. JSON
    - see above
  3. Native HTML (too complicated to generate from markdown; also home page uses JSON in accordion footer):
    - https://afdsi.com/ontomatica-home/

## Content management process

### Editing authorization

  * Follow the Google model:
    - https://github.com/ampproject/amp-github-apps/blob/main/owners/OWNERS.example

### Editing process

  - https://github.com/ampproject/amp.dev/blob/future/contributing/documentation.md
  - https://github.com/ampproject/amp.dev/blob/future/contributing/samples.md

### Sample MD document

  - https://github.com/ampproject/amphtml/blob/main/extensions/amp-accordion/amp-accordion.md

---

## Background: Google Accelerated Mobile Page (AMP)

It is important that Stripe fully understands how Google technology and methods work. Reasons:
  1. We want to demonstrate what we learned from Google by correctly applying their methods
  2. We want to "stand on their shoulders" to add value to their methods
  3. We want to stay current with Google updates to their methods
  4. We want to **minimize expense** by *leveraging* Google methods

Google AMP project (https://github.com/ampproject) has four main repositories:
  1. amp-html
     * enables JavaScript libraries for HTML
  2. amp-dev
     * enables AMP website
  3. amp-toolbox
     * tools to publish and host AMP pages
  4. amp-github-apps
     * apps for the amp-project

## 1 AMP-HTML

  * Important link:
    - https://github.com/ampproject/amphtml
  * Sample AMP-HTML workflows:
    - https://github.com/ampproject/amphtml/tree/main/.github/workflows

Google leaders:

  * Daniel Rozenberg
    - https://github.com/danielrozenberg
    - https://github.com/ampproject/cdn-configuration
  * Raghu Simha 
    - https://github.com/rsimha
    - https://github.com/ampproject/amphtml/blob/main/docs/release-schedule.md
    - https://amp.dev/documentation/guides-and-tutorials/learn/spec/release-schedule/

Google performs regular updates to the amp-html-libraries.
Here are examples of GitHub-Action-based production builds as described in `release-schedule`:

  *  https://github.com/ampproject/amphtml/actions/runs/2211747490
  *  https://github.com/ampproject/amphtml/actions/runs/2200511336

## 2 AMP-DEV

  * Important link:
    - https://github.com/ampproject/amp.dev
  * Google leader:
    - Sebastian Benz
      - https://github.com/sebastianbenz

## 3 AMP-TOOLBOX

  * Important link:
    - https://github.com/ampproject/amp-toolbox
    - https://github.com/erwinmombay/amp-toolbox/tree/modulepreload
  * Key tools:
    - Lint
      - https://github.com/erwinmombay/amp-toolbox/tree/modulepreload/packages/linter
    - Optimizer
      - https://github.com/erwinmombay/amp-toolbox/tree/modulepreload/packages/optimizer

Google leader:

  * Sebastian Benz
    - https://github.com/sebastianbenz

## 4 AMP-GITHUB-APPS

  * Important link:
    - https://github.com/ampproject/amp-github-apps

## Maintain code base at same level used by Google

  * Implement renovate bot
    - https://github.com/apps/renovate

## AMP-ADVICE

We can ask Google leaders for specific advice about part of the project.
In the past, Google leaders have helped us.
However, we must demonstrate *what* we have accomplished and *where* a problem occurs.
Google leaders almost always ask for a log file.

---

## Future projects

## Build production sites from single master GH repository

  * Generate approved content for target production sites.

### Related issues

  * We will need equivalent for AWS cloudfront (https://aws.amazon.com/cloudfront/)
    - https://github.com/ampproject/cloudflare-amp-optimizer
  * Optimization is currently part of amp.dev toolchain: server side optimization
    - https://amp.dev/documentation/guides-and-tutorials/optimize-and-measure/amp-optimizer-guide/?format=websites
  * Google cache is enabled if page is AMP-valid: signed exchange
    - https://amp.dev/documentation/guides-and-tutorials/optimize-and-measure/signed-exchange/?format=websites

## Migration from GitHub Action to CircleCI

  * Migrate to CircleCI when it is more economical than GitHub Actions

### Google CircleCI templates

  * Reference:
    - https://github.com/ampproject/amphtml/tree/main/.circleci
  * Example:
    - https://app.circleci.com/pipelines/github/ampproject/amphtml/23581/workflows/c6c69781-b3ba-4980-8530-2e45e9b32c32/jobs/475307

## Upgrade Grow development platform

  * Modify toolchain and workflow to seamlessly upgrade to new Grow release
    - Grow technical support will help mitigate breakage casued by upgrade
