# Meeting Notes: 22-02-22

## Project name

- Improve a CI/CD pipeline

## Project objectives

- From a single GitHub repository, generate separate sites for 6 companies that are part of a single Consortium

## Project GitHub source

- [link: amp.dev local](https://github.com/ankitadhandha/amp.dev)
- [link: amp.dev master](https://github.com/ampproject/amp.dev)

## Organization Background

### Outline: product positioning

- [link: product positioning](https://afdsi.com/_svg-projects/_rfp-positioning/)

### Preview: organization, product logos

- [link: logos](https://afdsi.com/logo-org-product/)

---

## CI/CD pipeline tools

## Summary

- Pipeline includes 60+ tools ranging from **acorn** to **websockets**
  - See table below

## Repo tree

- See amp.dev repository tree
  - [link: amp.dev tree](https://drive.google.com/file/d/18hSAeiEn5l95UeQMs2dcZ8paIf8TP6ER/view?usp=sharing)

## File types

- .ads, .cfg, .css, .ejs, .gitignore, .hbs, .html, .j2, .jpg, .js, .json, .md, .mp4, .pdf, .png, .py, .scss, .sh, .svg, .toml, .ts, .ttf, .txt, .ui, .webm, .woff, .woff2, .xml, .yaml

## Static site generator

- Grow is the static site generator
  - [link: grow site](https://grow.dev/)
  - [link: grow github](https://github.com/grow/)
- using Jinja templates
  - [link: jinja](https://jinja.palletsprojects.com/en/3.0.x/)

## Services

- The CI/CD pipeline also invokes node.js processes for server-side action such as
  - search integration
  - page optimization
  - page compression
- Google node.js services are listed here
  - [link: amp-toolbox](https://github.com/ampproject/amp-toolbox)

---

## Project Management

## Leadership

- Consortium's Project Manager (PM) resides in Jamnagar, Gujarat, India
- PM will be point-of-contact
- PM will conduct regular calls/meeting with Developer to review progress
- PM will help Developer "jump start" project by sharing progress-to-date and open issues
- PM mobile is: +91 9409 xxxxxx

## Experience

- PM understands "how we work", sees the "big picture" and is trusted by Consortium management
- PM has Docker and node.js/Express experience
- PM controls Consortium AWS privileges and services and will provide appropriate AWS access, authorization and authentication

---

## Summary - Stripe Systems

## Recent experience with implementing amp.dev environment

- amp.dev set-up is complex, under-automated and can be simplified

## Stripe top level advice

- Implement docker containers and docker executables for three environments
  - LOCAL (the container used by an application developer to create content)
  - DEV (the GitHub repo container that sets MASTER and maintains the BRANCH created by different application developers)
  - QA (the docker container that runs on an AWS domain and is accessible by multiple users who evaluate a planned release)

---

## Nomenclature

## Where we are; where we want to be

- AS-IS
  - current state of Consortium systems
- TO-BE
  - desired state of Consortium systems

## Site partitions for mono repo

- In order to maintain a mono repo but partition site content, use a two-letter prefix
  - /aa/20-digit-identifier/
  - /ba/20-digit-identifier/
  - /ca/20-digit-identifier/
  - /da/20-digit-identifier/
  - /ea/20-digit-identifier/
  - /fa/20-digit-identifier/
- The URL will be
  - {domain}/aa/20-digit-identifier/
  - {domain}/ba/20-digit-identifier/
  - {domain}/ca/20-digit-identifier/
  - {domain}/da/20-digit-identifier/
  - {domain}/ea/20-digit-identifier/
  - {domain}/fa/20-digit-identifier/

---

## Project

## Project tasks

1 Use automation to document and visualize the pipeline
- Operating structure [link](https://octo-repo-visualization.vercel.app/?repo=ankitadhandha%2Famp.dev)
- Base amp.dev structure [link](https://octo-repo-visualization.vercel.app/?repo=ampproject%2Famp.dev)

2 Implement Docker container strategy

3 Ensure that CI/CD pipeline works for both Apple/Mac/Homebrew and Windows/WSL and that test pages can be previewed on Apple/Mac or Windows

4 Where possible and appropriate, simplify the pipeline

5 Replace amp.dev AS-IS content with Consortium TO-BE content

6 Enable generation of six separate sites from one repository
- Sites will share many services (CSS, JS) but will use distinct colors, fonts, symbols and content

7 Enable integration with server-side node.js processes such as support for Google Custom Search and optimization/compression

---

## Operating notes

File system will use a 20-digit-identifier (not a character string); there is no directory tree
- Examples
  - https://ontomatica.io/a/12370110501010001961/
  - https://ontomatica.io/a/12370110501010001939/

All file names are
- index.html

Only two other file exists in a directory
- data.json
- text.txt

We will generate pages for 14 Natural Languages (one reason for using Grow)

## Grow and related CSS links

- [Grow built-in fields 1](https://github.com/ampproject/amp.dev/blob/future/contributing/documentation.md)
- [Grow built-in fields 2](https://github.com/ampproject/amp.dev/blob/future/contributing/samples.md)
- [SCSS sample](https://github.com/ampproject/amp.dev/tree/6c909a6a8c66e2941e56cea29dfccf725c288057/frontend/scss)
- [SCSS location](https://github.com/ampproject/amp.dev/blob/future/boilerplate/templates/styles/main.scss)
- [SCSS components](https://github.com/ampproject/amp.dev/tree/future/frontend/scss/components)
- [SCSS for $home](https://github.com/ampproject/amp.dev/blob/future/frontend/scss/components/templates/home.scss)
- [Animated CSS](https://github.com/animate-css/animate.css)
- [Source: animate.css](https://animate.style/)

## Acceptance Test

**A** preview changes on Apple/Mac and Windows/WSL before committing a development branch (based on Stripe Systems advice)

**B** generate homepage for 6 sites
- site #1 has a [unique format](https://afdsi.com/ontomatica-home/)
- sites #2 - #6 will use a generic template

**C** generate sidebar menu level 1 and 2 and target page for level 2

**D** generate page with accordion footer
- example [link: accordion](https://ontomatica.io/a/12370110501010001939/)

**E** generate Natural Language (NL) site menu
- example [link: natural languages](https://ontomatica.io/a/12370110501010001939/)

**F** generate page with amp-list using double brace JSON {{text}}
- example [link: double braces](https://ontomatica.io/a/12370110501010001939/)

**G** generate page with amp-list using triple brace JSON {{{text}}}
- example [link: triple braces](https://ontomatica.io/a/12120000001000011961/)

**H** inject JSON-LD
- example [link: json-ld](https://ontomatica.io/a/12370110501010001939/)

**I** generate page using amp-iframe
- example [link: iFrame](https://afdsi.com/ontomatica-home/)

---

## Documentation

## How AMP Works

- [AMP overview](https://amp.dev/about/how-amp-works/)
- [AMP overview source](https://github.com/ampproject/amp.dev/blob/future/pages/content/amp-dev/about/how-amp-works.html)
- [AMP documentation repository](https://github.com/ampproject/amp.dev/)
***
- [AMP production services end-to-end](https://github.com/ampproject/amphtml/blob/main/docs/getting-started-e2e.md)
- [AMP production services repository](https://github.com/ampproject/amphtml/)

## AMP sites

- [amp.dev production instance](https://amp.dev/about/websites/)
- [amp playground \(seen in visualization\)](https://playground.amp.dev/)
- [amp pixi \(seen in visualization\)](https://amp.dev/page-experience/)

## Google

- Google [instructions: installation](https://github.com/ampproject/amp.dev)
- Google [instructions: contributing documentation](https://github.com/ampproject/amp.dev/blob/future/contributing/documentation.md)
- Google [instructions: contributing samples 1](
https://github.com/ampproject/amp.dev/blob/future/contributing/samples.md)
- Google [instructions: contributing samples 2](https://gist.github.com/sebastianbenz/45d3dae499f35dedb65e01546356ff7a)
- Google [boilerplate link](https://github.com/ampproject/amp.dev/blob/future/boilerplate/templates/index.html)

## Contribution by 3rd party developer

- [Example 1](https://github.com/ampproject/amp.dev/pull/6013)
- [Example 2](https://github.com/ampproject/amp.dev/blob/future/examples/source/visual-effects/CSS_animation_in_email.html)

## From development to production

### Examples

#### Accordion

- amp-accordion [markdown page](https://github.com/ampproject/amphtml/blob/main/extensions/amp-accordion/amp-accordion.md)
- amp-accordion [production page](https://amp.dev/documentation/components/amp-accordion/)

#### List
- amp-list [markdown page](https://github.com/ampproject/amphtml/blob/master/extensions/amp-list/amp-list.md)
- amp-list [production page](https://amp.dev/documentation/components/amp-list/?format=websites)

### Natural Language items

- [localization 1](https://github.com/ampproject/amp.dev/issues/4800)
- [localization 2](https://github.com/ampproject/amp.dev/pull/4969/commits/2bb95c3e4043b6ece6da156d46501fb5380d2eef)

## Google instructions

- GitHub actions [link - workflows](https://github.com/ampproject/amphtml/tree/main/.github/workflows)

## Google example

- Staging on appspot.com
  - https://amp-dev-staging.appspot.com/
  - https://amp-dev-staging.appspot.com/about/websites-2021/
  - https://cloud.google.com/appengine/docs/standard/python3/an-overview-of-app-engine

## Relevant, insightful, important Google GitHub dialog

### Google discussion

- Improving project workflow [link - discussion](https://github.com/ampproject/amp.dev/issues/3330)

### Google Docker project

- [amp.dev and Docker project](https://github.com/ampproject/amp.dev/pull/5989)

> "I can't get Grow to run on app engine."

- note: we don't use appengine; we deploy on AWS Cloudfront

### Issues

- https://github.com/ampproject/amp.dev/issues/5110
- https://github.com/ampproject/amp.dev/issues/6067
- https://github.com/ampproject/amp.dev/issues/6204
- https://github.com/ampproject/amphtml/issues/28168

### Pulls

- https://github.com/ampproject/amp.dev/pull/3733
- https://github.com/ampproject/amp.dev/pull/4018
- https://github.com/ampproject/amp.dev/pull/4924/files/3bb0b820dbc47e235db890aad5875f24712a6fe9..ec957e2d1b2a8f3a555dca217ce0ae8eec30acca
- https://github.com/ampproject/amp.dev/pull/5047
- https://github.com/ampproject/amp.dev/pull/5224/files/dc082fe19c48703efd8b33226ca3f0fd3883533d..6ba596e30ab7bd1d64bb0805c6f3787c24038add
- https://github.com/ampproject/amp.dev/pull/5292
- https://github.com/ampproject/amp.dev/pull/5467/files/4c899d45345978016c5b3786b82e30a0d77b7e3e..a5a0f58fe05f534f5c7f74304132515cdbbbdc85
- https://github.com/ampproject/amp.dev/pull/5989/files/7b4a42ab74fba5f960148fe5aad3799e1ce82d36..75689aa6216573baf4c635f222de182584970a1b
- https://github.com/ampproject/amp.dev/pull/6024
- https://github.com/ampproject/amp.dev/pull/6041
- https://github.com/ampproject/amp.dev/pull/6205

---

## Dialog: Anant and Jay

## AS-IS

> Anant@StripeSys:
>> Do you have any existing CI/CD Pipeline? If yes, where is it configured and how? CI/CD tools involved?

>> How many environments do you have currently?

>> Current deployment strategy?

> JG
>> We build and docker 10 instances of Python/MySQL apps on three AWS/EC2 servers

>> We build a Sphinx/Python instance from a GitHub repo and deploy simultaneously on ReadTheDocs and an AWS/EC2 server

## Project objectives: from a single GitHub repository, generate separate sites for 6 companies that are part of a single Consortium.

> Anant@StripeSys:
>> Do you have a clear demarcation of the six sites in terms of the codebase?

>> Please, provide the exact paths of the six sites in question.

>> Do they share anything in common or are completely separate/distinct and can be deployed, independently?

> JG
>> //afdsi.org

>> //ontomatica.io

>> //dailyfood.io

>> //dailycare.io

>> //electronic-label.io

>> //export-import-data.io

### Project status: Seeking a Developer with skills to solve specific problems; help to enable fully automated generation of Consortium sites.

> Anant@StripeSys:
>> What do you mean by automated generation of sites? Are you referring to the build process of the six sites on "push commits"?

> JG
>> Correct: push commits

>> We need to incrementally update a site after making changes to the shared repo

### CI/CD tools summary: Pipeline includes 60+ tools ranging from acorn to websockets

> Anant@StripeSys:
>> Would you be able to provide a short summary of tools with their exact function/purpose?

>> Which CI/CD tool has been used to host the pipelines?

>> Jenkins/TC/Travis/Azure DevOps/AWS CodeBuild?

>> Any artifactory in use?

### Core technologies: Grow is the static site generator

> Anant@StripeSys:
>> Is this supposed to be integrated into the pipeline for the automation purpose?

> JG
>> Correct. Grow is like all other static site generators.

>> Grow provides an open/close structure that contains substitution commands.

>> The substitution commands load libraries in \<head\> and content in \<body\>.

>> The substitution commands are very similar to Handlebars and Mustache.

>> Grow is designed to support sites with a large number of pages.

>> Grow also supports Natural Languages (NLs).

>> In the final state (sometime in the future) all sites will be delivered in 14 NLs.

>> The “RDF in 50 Words Or Less” example illustrates how we plan to do this.

- using Jinja templates: https://jinja.palletsprojects.com/en/3.0.x/

> Anant@StripeSys:
>> What are the expectations around this?

> JG
>> The templates used by Grow are Jinja templates

>> These are nearly identical to templates used by other static site generators.

>> The CI/CD pipeline also invokes node.js processes for server-side action such as search integration, page optimization and page compression.

> Anant@StripeSys:
>> What is CI/CD pipeline supposed to do after invoking the above mentioned actions?

> JG
>> node.js commands bind an action or perform a job.

>> Example: when a finished HTML page is generated, a node.js function triggers an optimizer that injects optimization routines into the page.

>> Another node.js function minimizes the HTML page.

>> Another node.js function uses Brotl to compress the page.

### Project tasks:

#### Use automation to document and visualize the pipeline.

> Anant@StripeSys:
>> What do you exactly mean by documenting and visualising the pipeline?

>> Are you referring to the visualisation of builds, build logs, UT, CC or something else? Need clarity on this.

> JG
>> In the past CircleCI provided visualization

>> More recently GitHub has implemented CircleCI-like visualization that seem to be “good enough”

>> Example: https://github.com/ampproject/amp.dev/runs/4615877272?check_suite_focus=true#step:10:11

#### Ensure that CI/CD works for both Apple/Mac/Homebrew and Windows/WSL and that test pages can be previewed on Apple/Mac or Windows.

> Anant@StripeSys:
>> Is the build/artifact supposed to work on Mac machines? If yes, then MAC agents would be required? Where are you exactly testing the Mac builds - Macbooks or Mac server?

> JG
>> Currently we can build and preview locally on a MacBook using Homebrew.

>> We also can build an AWS/EC2 instance.

>> We have not been able to build locally using Windows/WSL and Ubuntu.

>> We are experimenting with a Debian distro for WSL.

>> The Debian distro should work.

#### Where possible and appropriate, simplify the pipeline.

> Anant@StripeSys:
>> Any specified instruction/expectation around this?

> JG
>> Our thought is that a 3rd party, such as your organization, would see opportunities that we do not.

>> '#3' is saying to our CI/CD partner: “we’re willing to change this process if there is a better way”

#### We will generate pages for 14 Natural Languages (one of the reasons for using Grow).

> Anant@StripeSys:
>> Is this something of development team's interest or Devops or both?

>> Will this play any role with the setting up and maintaining the CI/CD Pipelines?

>JG
>> NL support is vital to the project. Arguably there is no higher priority.

>> The test site is ontomatica.io following the RDF-in-50 example.

>> At the end state, every page will be coded in 14 NLs.

## amp.dev tool list

|TOOL-NAME|TOOL-SOURCE|TOOL-GITHUB-LINK|
|:--------|:----------|:--------------|
|acorn|acornjs|https://github.com/acornjs/acorn|
|animate.css|animate-css|https://github.com/animate-css/animate.css|
|babel|babel|https://github.com/babel/babel|
|babel-loader|babel|https://github.com/babel/babel-loader|
|cheerio|cheeriojs|https://github.com/cheeriojs/cheerio|
|clean-css|jakubpawlowicz|https://github.com/jakubpawlowicz/clean-css|
|closure-compiler-npm|google|https://github.com/google/closure-compiler-npm|
|closure-webpack-plugin|webpack-contrib|https://github.com/webpack-contrib/closure-webpack-plugin|
|CodeMirror|codemirror|https://github.com/codemirror/CodeMirror|
|colorette|jorgebucaran|https://github.com/jorgebucaran/colorette|
|cookie-parser|expressjs|https://github.com/expressjs/cookie-parser|
|copy-webpack-plugin|webpack-contrib|https://github.com/webpack-contrib/copy-webpack-plugin|
|debug|visionmedia|https://github.com/visionmedia/debug|
|dropzone|dropzone|https://github.com/dropzone/dropzone|
|dropzone|meno|https://gitlab.com/meno/dropzone|
|eslint|eslint|https://github.com/eslint/eslint|
|eslint-config-prettier|prettier|https://github.com/prettier/eslint-config-prettier|
|eslint-plugin-prettier|prettier|https://github.com/prettier/eslint-plugin-prettier|
|express|expressjs|https://github.com/expressjs/express|
|filemanager-webpack-plugin|gregnb|https://github.com/gregnb/filemanager-webpack-plugin|
|globby|sindresorhus|https://github.com/sindresorhus/globby|
|gulp|gulpjs|https://github.com/gulpjs/gulp|
|handlebars.js|handlebars-lang|https://github.com/handlebars-lang/handlebars.js|
|hbs|pillarjs|https://github.com/pillarjs/hbs|
|highlight.js|highlightjs|https://github.com/highlightjs/highlight.js|
|html-loader|webpack-contrib|https://github.com/webpack-contrib/html-loader|
|html-webpack-plugin|jantimon|https://github.com/jantimon/html-webpack-plugin|
|http-errors|jshttp|https://github.com/jshttp/http-errors|
|husky|typicode|https://github.com/typicode/husky|
|ini|npm|https://github.com/npm/ini|
|ioredis|luin|https://github.com/luin/ioredis|
|jasmine-npm|jasmine|https://github.com/jasmine/jasmine-npm|
|joi|sideway|https://github.com/sideway/joi|
|js-beautify|beautify-web|https://github.com/beautify-web/js-beautify|
|js-yaml|nodeca|https://github.com/nodeca/js-yaml|
|markdown-it|markdown-it|https://github.com/markdown-it/markdown-it|
|marked|markedjs|https://github.com/markedjs/marked|
|mini-css-extract-plugin|webpack-contrib|https://github.com/webpack-contrib/mini-css-extract-plugin|
|morgan|expressjs|https://github.com/expressjs/morgan|
|nanoid|ai|https://github.com/ai/nanoid|
|needle|tomas|https://github.com/tomas/needle|
|node-archiver|archiverjs|https://github.com/archiverjs/node-archiver|
|nodejs-datastore|googleapis|https://github.com/googleapis/nodejs-datastore|
|node-rcs-core|JPeer264|https://github.com/JPeer264/node-rcs-core|
|nunjucks|mozilla|https://github.com/mozilla/nunjucks|
|octonode|pksunkara|https://github.com/pksunkara/octonode|
|postcss|postcss|https://github.com/postcss/postcss|
|postcss-safe-parser|postcss|https://github.com/postcss/postcss-safe-parser|
|probe-image-size|nodeca|https://github.com/nodeca/probe-image-size|
|renovate-bot|renovate-bot|https://github.com/renovate-bot|
|rss-to-json|nasa8x|https://github.com/nasa8x/rss-to-json|
|sass-loader|webpack-contrib|https://github.com/webpack-contrib/sass-loader|
|supertest|visionmedia|https://github.com/visionmedia/supertest|
|svg-spritemap-webpack-plugin|cascornelissen|https://github.com/cascornelissen/svg-spritemap-webpack-plugin|
|through2|rvagg|https://github.com/rvagg/through2|
|uuid|uuidjs|https://github.com/uuidjs/uuid|
|webpack|webpack|https://github.com/webpack/webpack|
|webpack-build-notifier|RoccoC|https://github.com/RoccoC/webpack-build-notifier|
|webpack-cli|webpack|https://github.com/webpack/webpack-cli|
|webpack-dev-server|webpack|https://github.com/webpack/webpack-dev-server|
|ws|websockets|https://github.com/websockets/ws|

